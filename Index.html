<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>cog world</title>
</head>
<body>
<button type="button" onclick="newLargeCog()">+cog(40)</button>
<button type="button" onclick="newSmallCog()">+cog(20)</button>
<canvas id="canvas"></canvas>

<script src="js/NameSpaces.js"></script>
<script src="js/Cog.js"></script>
<script src="js/World.js"></script>
<script src="js/drivers/ClockAngleDriver.js"></script>
<script src="js/drivers/ReverseAngleDriverDecorator.js"></script>
<script src="js/drawables/CogDrawable.js"></script>
<script>
    var world = new CogWorld.World();

    var largeCog = new CogWorld.CogBuilder().teath(40);
    var smallCog = new CogWorld.CogBuilder().teath(20);

    var drawables = [];

    var clock = new CogWorld.Drivers.ClockAngleDriver();
    var driver = clock;

    function newLargeCog() {
        newCog(largeCog);
    }

    function newSmallCog() {
        newCog(smallCog);
    }

    function newCog(builder) {
        var cog = builder.build();
        cog.setX(50 + 85 * drawables.length);
        cog.setY(50);
        cog.setAngleDriver(driver);
        world.add(cog);
        drawables.push(new CogWorld.Drawables.CogDrawable(cog));
        driver = new CogWorld.Drivers.ReverseAngleDriverDecorator(driver);
        redraw();
    }

    function redraw() {
        var canvas = document.getElementById("canvas");
        var context = canvas.getContext("2d");
        context.fillStyle = "white";
        context.fillRect(0, 0, canvas.width, canvas.height);

        for (var i = 0; i < drawables.length; i++) {
            var drawable = drawables[i];
            context.save();
            drawable.draw(context);
            context.restore();
        }
    }
    newLargeCog();

    function step(timestamp) {
        clock.setTime(timestamp);
        redraw();
        animate();
    }

    function animate() {
        requestAnimationFrame(step, 1000 / 60);
    }

    animate();
</script>
</body>
</html>